"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[276],{4787:(t,e,i)=>{i(538).ZP.component("v-venta-modal",i(2550).Z)},2550:(t,e,i)=>{i.d(e,{Z:()=>c});function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){o(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function o(t,e,i){return(e=function(t){var e=function(t,e){if("object"!==s(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===s(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const r={props:["itinerario","usuario","sucursales"],data:function(){return{tickets:[],asientos:[],modalInstance:null,currentTicket:null,currentTicketIndex:-1,asientos_vendidos:0,asientos_reservados:0,asientos_bloqueados:0,pto_ventas:[],formTemplate:{cliente_id:0,tipo_documento:1,numero_documento:"",nombres:"",paterno:"",materno:"",fecha_nacimiento:"",sexo:"",telefono:"",email:"",nacionalidad:"",es_nino:0,embarque_origen_id:0,embarque_destino_id:0,fecha_venta:dayjs().format("DD/MM/YYYY"),tipo:"1",fecha_reserva:"",n_asiento:0,comprobante:"BOLETA",correlativo:"FP11-00000093",totalpago:0}}},watch:{itinerario:function(t,e){t.id>0&&(this.obtenerAsientos(),this.obtenerPtoVentas())}},setup:function(){},computed:{asientos_disponibles:function(){var t=this;return this.asientos.filter((function(t){return null==t.venta_id})).filter((function(e){return null==t.tickets.find((function(t){return t.n_asiento==e.asiento_id}))}))}},methods:{addTicket:function(t){this.tickets.push(a(a({},this.formTemplate),{},{n_asiento:t.asiento_id,asiento_numero:t.numero})),this.currentTicketIndex=this.tickets.length-1,this.currentTicket=this.tickets[this.tickets.length-1],this.modalInstance.hide()},changeTicket:function(t){this.currentTicketIndex=t,this.currentTicket=this.tickets[t]},closeTicket:function(){this.tickets.splice(this.currentTicketIndex,1),this.tickets.length>1?this.changeTicket(this.currentTicketIndex-1):1==this.tickets.length?this.changeTicket(0):this.currentTicket=null},obtenerAsientos:function(){var t=this;axios.get("/itinerario/"+this.itinerario.id+"/asientos").then((function(e){t.asientos=e.data,t.recalcularAsientos()}))},obtenerPtoVentas:function(){var t=this;axios.get("/ventas/ptoventas",{params:{itinerario_id:this.itinerario.id}}).then((function(e){t.pto_ventas=e.data}))},openModal:function(){this.modalInstance=new bootstrap.Modal(document.getElementById("modal-asientos-disponibles"),{backdrop:"static",keyboard:!1}),this.modalInstance.show()},onRegisteredVenta:function(){this.closeTicket(),this.obtenerAsientos(),this.obtenerPtoVentas()},recalcularAsientos:function(){var t=this;setTimeout((function(){t.asientos_vendidos=t.asientos.filter((function(t){return t.venta_id>0&&"V"==t.venta_tipo&&1==Number(t.venta_estado)})).length,t.asientos_reservados=t.asientos.filter((function(t){return t.venta_id>0&&"R"==t.venta_tipo&&1==Number(t.venta_estado)})).length}),500)}}};const c=(0,i(1900).Z)(r,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-6 d-flex flex-row align-items-center"},[e("div",{staticClass:"px-1"},[t._v(t._s(t.itinerario.bus_placa))]),e("span",[t._v("|")]),t._v(" "),e("div",{staticClass:"px-1"},[t._v(t._s(t.itinerario.origen_nombre))]),e("span",[t._v("|")]),t._v(" "),e("div",{staticClass:"px-1"},[t._v(t._s(t.itinerario.destino_nombre))]),e("span",[t._v("|")]),t._v(" "),e("div",{staticClass:"px-1"},[t._v(t._s(t.itinerario.fecha_partida))]),e("span",[t._v("|")]),t._v(" "),e("div",{staticClass:"px-1"},[t._v(t._s(t.itinerario.hora_partida))])]),t._v(" "),e("div",{staticClass:"col-6 d-flex flex-row justify-content-end"},[e("h5",{staticClass:"me-1"},[e("span",{staticClass:"badge bg-primary"},[t._v("Capacidad: "+t._s(t.asientos.length))])]),t._v(" "),e("h5",{staticClass:"me-1"},[e("span",{staticClass:"badge bg-info"},[t._v("Vendidos: "+t._s(t.asientos_vendidos))])]),t._v(" "),e("h5",{staticClass:"me-1"},[e("span",{staticClass:"badge bg-warning"},[t._v("Reservados: "+t._s(t.asientos_reservados))])]),t._v(" "),t._m(0),t._v(" "),e("h5",{staticClass:"me-1"},[e("span",{staticClass:"badge bg-secondary"},[t._v("Disponibles: "+t._s(t.asientos.length-t.asientos_vendidos-t.asientos_reservados))])])])]),t._v(" "),e("div",{staticClass:"py-2"},[e("div",{staticClass:"fs-3 fw-bold text-center text-primary"},[t._v("Conductores")]),t._v(" "),e("div",{staticClass:"d-flex flex-row align-items-center justify-content-center fs-6"},[t.itinerario.chofer_id>0?e("div",[e("span",{staticClass:"text-primary"},[t._v("Conductor 1: ")]),t._v(" "+t._s(t.itinerario.chofer1_nombres))]):t._e(),t._v(" "),t.itinerario.chofer2_id>0?e("div",[e("span",{staticClass:"text-primary"},[t._v("Conductor 2: ")]),t._v(" "+t._s(t.itinerario.chofer2_nombres))]):t._e()])]),t._v(" "),e("v-venta-bus",{attrs:{itinerario:t.itinerario,asientos:t.asientos}}),t._v(" "),e("div",{staticClass:"py-2"},[t._v(" ")]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-3"},[e("div",{staticClass:"table-responsive bg-white"},[e("table",{staticClass:"table table-hover table-sm",attrs:{id:"order-listing"}},[t._m(1),t._v(" "),e("tbody",t._l(t.pto_ventas,(function(i){return e("tr",{key:"ptoventa_"+i.id},[e("td",{staticClass:"text-truncate"},[t._v(t._s(i.nombre_comercial))]),t._v(" "),e("td"),t._v(" "),e("td",[t._v(t._s(i.conteo_ventas))])])})),0)])])]),t._v(" "),e("div",{staticClass:"col-9"},[e("div",[e("ul",{staticClass:"nav nav-pills",staticStyle:{"font-size":"12px","padding-bottom":".6rem"}},[e("li",{staticClass:"nav-item"},[e("a",{staticClass:"nav-link bg-secondary text-white",staticStyle:{"border-top-left-radius":"50px"},attrs:{href:"#"},on:{click:function(e){return t.openModal()}}},[e("i",{staticClass:"fa fa-plus-square"}),t._v(" Añadir")])]),t._v(" "),t._l(t.tickets,(function(i,s){return e("li",{key:"ticket_"+s,staticClass:"nav-item"},[e("a",{staticClass:"nav-link",class:{active:s==t.currentTicketIndex},attrs:{href:"#"},on:{click:function(e){return t.changeTicket(s)}}},[t._v("Asiento "+t._s(i.asiento_numero))])])}))],2),t._v(" "),null!==t.currentTicket?e("div",{attrs:{id:"venta-form-container"}},[e("v-venta-form",{attrs:{itinerario:t.itinerario,ticket:t.currentTicket,sucursales:t.sucursales,usuario:t.usuario},on:{"on-close":function(e){return t.closeTicket()},"on-success":function(e){return t.onRegisteredVenta(e)}}})],1):t._e()])])]),t._v(" "),e("div",{staticClass:"modal fade",attrs:{id:"modal-asientos-disponibles",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"}},[e("div",{staticClass:"modal-dialog"},[e("div",{staticClass:"modal-content"},[t._m(2),t._v(" "),e("div",{staticClass:"modal-body p-3"},t._l(t.asientos_disponibles,(function(i,s){return e("div",{key:s,staticClass:"d-grid mb-2"},[e("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(e){return t.addTicket(i)}}},[t._v("Asiento "+t._s(i.numero)+" - Piso "+t._s(i.piso+1))])])})),0)])])])],1)}),[function(){var t=this._self._c;return t("h5",{staticClass:"me-1"},[t("span",{staticClass:"badge bg-danger"},[this._v("Bloqueados: 0")])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",{staticClass:"text-center align-middle"},[t._v("Punto de V.")]),t._v(" "),e("th",{staticClass:"text-center align-middle"},[t._v("Abrev.")]),t._v(" "),e("th",{staticClass:"text-center align-middle"},[t._v("Cant.")])])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[t._v("Selecciona el asiento")]),t._v(" "),e("button",{staticClass:"btn-close",attrs:{type:"button","data-bs-dismiss":"modal","aria-label":"Close"}})])}],!1,null,null,null).exports},1900:(t,e,i)=>{function s(t,e,i,s,n,a,o,r){var c,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=i,l._compiled=!0),s&&(l.functional=!0),a&&(l._scopeId="data-v-"+a),o?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},l._ssrRegister=c):n&&(c=r?function(){n.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:n),c)if(l.functional){l._injectStyles=c;var d=l.render;l.render=function(t,e){return c.call(e),d(t,e)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return{exports:t,options:l}}i.d(e,{Z:()=>s})}},t=>{t.O(0,[598],(()=>{return e=4787,t(t.s=e);var e}));t.O()}]);